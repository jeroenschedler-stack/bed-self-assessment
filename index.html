<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>BED Hospitality — Self-Assessment (SAR)</title>
  <meta name="theme-color" content="#1E90FF" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <link rel="icon" href='data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64"><rect width="64" height="64" rx="12" fill="%231E90FF"/><text x="50%" y="56%" font-size="28" font-family="Arial,Helvetica,sans-serif" font-weight="700" text-anchor="middle" fill="white">BED</text></svg>'>

  <style>
    :root{
      --brand:#1E90FF;
      --border:#E5E7EB;
      --text:#111827;
      --sub:#374151;
      --active:#FF3B30; /* red active dot */
    }
    *{box-sizing:border-box}
    html,body{width:100%;height:auto;margin:0;padding:0}
    body{font-family:Inter,system-ui,-apple-system,Arial,sans-serif;background:#F9FAFB;color:var(--text)}

    /* Header */
    .sar-header{
      position:sticky;top:0;z-index:5;height:64px;
      display:flex;align-items:center;justify-content:space-between;
      padding:0 12px;background:#fff;border-bottom:1px solid var(--border)
    }
    @media (min-width:768px){ .sar-header{padding:0 16px} }
    .sar-logo{font-size:18px;font-weight:600;letter-spacing:.2px}
    .sar-dotbar{display:flex;gap:10px;align-items:center}
    .sar-dot{width:16px;height:16px;border-radius:50%;background:#E5E7EB;transition:background .3s ease}
    .sar-dot.active{background:var(--active)}

    /* Layout */
    .sar-wrap{max-width:100%;width:100%;margin:0;padding:8px 12px 24px}
    @media (min-width:768px){ .sar-wrap{max-width:560px;margin:16px auto;padding:0 16px 24px} }

    /* Card */
    .sar-card{
      background:#fff;border:1px solid var(--border);border-radius:12px;
      padding:20px 16px;box-shadow:0 1px 2px rgba(0,0,0,.04);min-height:auto
    }
    @media (max-width:430px){
      .sar-wrap{padding:0}
      .sar-card{border:none;box-shadow:none;border-radius:0;padding:16px}
      body{padding-bottom:env(safe-area-inset-bottom,16px)}
    }

    /* Titles */
    .sar-title{font-size:18px;font-weight:600;margin:8px 0 12px}
    .sar-sub{color:var(--sub);margin-bottom:16px}

    /* Rows & buttons */
    .sar-row{display:flex;gap:8px;flex-wrap:wrap}
    .sar-actions{display:flex;gap:8px;margin-top:16px}
    .sar-btn{
      display:inline-flex;align-items:center;justify-content:center;
      min-height:44px;padding:8px 12px;border-radius:8px;border:1px solid #D1D5DB;
      background:#fff;color:var(--text);cursor:pointer;text-decoration:none;user-select:none;font-size:14px
    }
    .sar-btn.primary{background:var(--brand);color:#fff;border-color:var(--brand)}
    .sar-btn:disabled{opacity:.6;cursor:not-allowed}

    /* Pages */
    .sar-page{display:none}
    .sar-page.active{display:block}

    /* Inputs */
    .sar-row-fields{gap:12px}
    .sar-field{flex:1;min-width:0;display:flex;flex-direction:column;gap:6px}
    .sar-label{font-size:12px;color:#6B7280}
    .sar-input{
      height:44px;padding:8px 10px;border:1px solid #D1D5DB;border-radius:8px;
      background:#fff;color:var(--text);outline:none;font-size:16px
    }
    .sar-input:focus{border-color:var(--brand);box-shadow:0 0 0 3px rgba(30,144,255,.15)}
    @media (max-width:420px){ .sar-row-fields{flex-direction:column} }

    /* Hotels one row */
    .sar-hotels{display:flex;gap:6px;flex-wrap:nowrap;justify-content:space-between}
    .sar-hotels .sar-hotel{flex:1 1 18%;min-width:0;text-transform:uppercase;font-weight:600;padding:10px 0;font-size:14px}
    .sar-hotel.selected{background:var(--brand);color:#fff;border-color:var(--brand)}

    /* Intro & scale (welcome) */
    .sar-intro p,.sar-scale{font-size:14px;line-height:1.45}
    @media (max-width:360px){ .sar-intro p,.sar-scale{font-size:13px} }
    .sar-scale-row{display:flex;align-items:center;gap:10px;margin:6px 0}
    .sar-badge{display:inline-flex;align-items:center;justify-content:center;width:24px;height:24px;border-radius:50%;background:var(--brand);color:#fff;font-size:13px;font-weight:600}

    /* Question list (dynamic) */
    .q-list{display:flex;flex-direction:column;gap:14px}
    .q-item{padding:12px 0;border-top:1px solid var(--border)}
    .q-item:first-child{border-top:none}
    .q-title{font-size:15px;font-weight:600;line-height:1.35;margin-bottom:2px} /* bold only */
    .q-sub{font-size:15px;line-height:1.35;color:var(--sub);margin-bottom:8px}  /* same size */
    .q-scale{display:flex;gap:8px}
    .q-scale input[type="radio"]{position:absolute;opacity:0;pointer-events:none}
    .q-scale label{
      width:36px;height:36px;border-radius:50%;
      border:1px solid #D1D5DB;background:#fff;color:#111827;
      display:inline-flex;align-items:center;justify-content:center;
      font-size:14px;font-weight:600;cursor:pointer;user-select:none;
    }
    .q-scale input[type="radio"]:checked + label{
      background:var(--brand);border-color:var(--brand);color:#fff;
    }

    /* Thin progress bar */
    .thin-progress{height:4px;background:#E5E7EB;border-radius:3px;overflow:hidden;margin:-4px 0 12px}
    .thin-progress > span{display:block;height:100%;width:0;background:var(--brand);transition:width .25s ease}
  </style>
</head>
<body>

  <!-- Header -->
  <header class="sar-header">
    <div class="sar-logo">BED HOSPITALITY</div>
    <div class="sar-dotbar" id="dotbar" aria-label="Progress"></div>
  </header>

  <main class="sar-wrap">
    <section class="sar-card">

      <!-- Welcome -->
      <div class="sar-page" data-step="welcome">
        <div style="max-width:75%">
          <div class="sar-title">SELF-ASSESSMENT (SAR)</div>
          <div class="sar-sub" style="margin-bottom:16px">evaluate yourself and your peers</div>
        </div>

        <div class="sar-row sar-row-fields" style="margin-bottom:12px">
          <label class="sar-field">
            <span class="sar-label">your nickname</span>
            <input id="sarNick" type="text" class="sar-input" inputmode="text" autocomplete="nickname" />
          </label>
          <label class="sar-field">
            <span class="sar-label">your email</span>
            <input id="sarEmail" type="email" class="sar-input" inputmode="email" autocomplete="email" />
          </label>
        </div>

        <div class="sar-row sar-hotels" role="group" aria-label="Choose your BED Hotel" style="margin-bottom:12px">
          <button class="sar-btn sar-hotel" data-hotel="BCK">BCK</button>
          <button class="sar-btn sar-hotel" data-hotel="BPS">BPS</button>
          <button class="sar-btn sar-hotel" data-hotel="BNM">BNM</button>
          <button class="sar-btn sar-hotel" data-hotel="BCG">BCG</button>
          <button class="sar-btn sar-hotel" data-hotel="BED">BED</button>
        </div>

        <div class="sar-intro" style="margin-bottom:8px">
          <p>Self-assessment helps your personal growth and development. Read each statement and think how you act in these situations. Then select the rating that best fits you. Be honest with yourself. The goal is to know your own strengths and opportunities.</p>
        </div>

        <div class="sar-scale" style="margin-bottom:8px">
          <div class="sar-scale-row"><span class="sar-badge">1</span><span>I'm not good at this</span></div>
          <div class="sar-scale-row"><span class="sar-badge">2</span><span>I can do better in this</span></div>
          <div class="sar-scale-row"><span class="sar-badge">3</span><span>I'm good at this</span></div>
          <div class="sar-scale-row"><span class="sar-badge">4</span><span>I'm great at this</span></div>
          <div class="sar-scale-row"><span class="sar-badge">5</span><span>I'm excellent at this</span></div>
        </div>

        <div class="sar-actions">
          <button id="sarStart" class="sar-btn primary" data-nav="goto" data-step="q1" disabled>start</button>
        </div>
      </div>

      <!-- Part 1 — Dynamic questions -->
      <div class="sar-page" data-step="q1">
        <div class="sar-title" style="margin-bottom:6px">Self-Assessment · Part 1 of 2</div>
        <div class="thin-progress" aria-hidden="true"><span id="q1Prog"></span></div>

        <div id="q1List" class="q-list" aria-live="polite"></div>

        <div class="sar-actions">
          <button class="sar-btn" data-nav="back">Back</button>
          <button id="q1Next" class="sar-btn primary" data-nav="goto" data-step="q2" disabled>Next</button>
        </div>
      </div>

      <!-- Part 2 — Dynamic questions -->
      <div class="sar-page" data-step="q2">
        <div class="sar-title" style="margin-bottom:6px">Self-Assessment · Part 2 of 2</div>
        <div class="thin-progress" aria-hidden="true"><span id="q2Prog"></span></div>

        <div id="q2List" class="q-list" aria-live="polite"></div>

        <div class="sar-actions">
          <button class="sar-btn" data-nav="back">Back</button>
          <button id="q2Next" class="sar-btn primary" data-nav="next" disabled>Next</button>
        </div>
      </div>

      <!-- Placeholders for full 7-dot flow -->
      <div class="sar-page" data-step="score"><div class="sar-title">Your Score</div></div>
      <div class="sar-page" data-step="peer"><div class="sar-title">Peer Review</div></div>
      <div class="sar-page" data-step="done"><div class="sar-title">Done</div></div>
      <div class="sar-page" data-step="finish"><div class="sar-title">Finish</div></div>

    </section>
  </main>

  <script>
    // 7 steps for the dot bar
    const SAR_STEPS = ["welcome","q1","q2","score","peer","done","finish"];

    const sarState = {
      step: "welcome",
      user: { nickname: "", email: "", hotel: "" },
      answers: {},         // { qid: 1..5 }
      questions: []        // loaded from questions.json
    };

    // --- Navigation
    function goTo(step){
      if(!SAR_STEPS.includes(step)) return;
      sarState.step = step;
      document.querySelectorAll('.sar-page').forEach(p=>{
        p.classList.toggle('active', p.dataset.step === step);
      });
      renderDots();
      if(step === "welcome") ensureWelcomeBindings();
      if(step === "q1") renderQ1();
      if(step === "q2") renderQ2();   // ensure page 2 loads
      window.scrollTo({ top: 0, behavior: 'instant' });
    }
    function next(){
      const i = SAR_STEPS.indexOf(sarState.step);
      if(i < SAR_STEPS.length - 1) goTo(SAR_STEPS[i+1]);
    }
    function back(){
      const i = SAR_STEPS.indexOf(sarState.step);
      if(i > 0) goTo(SAR_STEPS[i-1]);
    }
    document.body.addEventListener('click', (e)=>{
      const btn = e.target.closest('[data-nav]');
      if(!btn) return;
      const act = btn.getAttribute('data-nav');
      if(act==='next') next();
      else if(act==='back') back();
      else if(act==='goto'){ const step = btn.getAttribute('data-step'); if(step) goTo(step); }
    });

    function renderDots(){
      const bar = document.getElementById('dotbar');
      bar.innerHTML = '';
      SAR_STEPS.forEach(step=>{
        const d = document.createElement('div');
        d.className = 'sar-dot' + (sarState.step === step ? ' active' : '');
        bar.appendChild(d);
      });
    }

    // --- Welcome bindings
    let welcomeBound = false;
    function ensureWelcomeBindings(){
      if(welcomeBound){ validateWelcome(); return; }
      welcomeBound = true;
      const card = document.querySelector('.sar-page[data-step="welcome"]');
      const nick = card.querySelector('#sarNick');
      const email = card.querySelector('#sarEmail');
      const startBtn = card.querySelector('#sarStart');

      card.addEventListener('click',(e)=>{
        const btn = e.target.closest('.sar-hotel');
        if(!btn) return;
        card.querySelectorAll('.sar-hotel').forEach(b=>b.classList.remove('selected'));
        btn.classList.add('selected');
        sarState.user.hotel = btn.getAttribute('data-hotel') || "";
        validateWelcome();
      });
      nick.addEventListener('input', ()=>{ sarState.user.nickname = nick.value.trim(); validateWelcome(); });
      email.addEventListener('input', ()=>{ sarState.user.email = email.value.trim(); validateWelcome(); });
      startBtn.addEventListener('click',(e)=>{ if(startBtn.disabled){ e.preventDefault(); e.stopPropagation(); } });
      validateWelcome();
    }
    function validateWelcome(){
      const card = document.querySelector('.sar-page[data-step="welcome"]');
      if(!card) return;
      const nick = card.querySelector('#sarNick');
      const email = card.querySelector('#sarEmail');
      const startBtn = card.querySelector('#sarStart');
      const hasNick = (nick.value || "").trim().length > 0;
      const hasEmail = /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test((email.value || "").trim());
      const hasHotel = !!sarState.user.hotel;
      startBtn.disabled = !(hasNick && hasEmail && hasHotel);
    }

    // --- Load questions.json once
    async function loadQuestions(){
      if (sarState.questions.length) return sarState.questions;
      const res = await fetch('./questions.json', {cache: 'no-store'});
      const data = await res.json();
      sarState.questions = Array.isArray(data) ? data : [];
      return sarState.questions;
    }

    // --- Render Part 1 (first 10)
    async function renderQ1(){
      const qs = await loadQuestions();
      const slice = qs.slice(0, 10);
      const mount = document.getElementById('q1List');
      mount.innerHTML = slice.map(q => renderQuestionHTML(q)).join('');

      // restore
      slice.forEach(q => {
        const v = sarState.answers[q.id];
        if(v){ const el = document.getElementById(`${q.id}_${v}`); if (el) el.checked = true; }
      });

      mount.onchange = onRatingChangedQ1;
      updateQ1Progress(slice);
      validateQ1Completed(slice);
    }

    // --- Render Part 2 (next 10)
    async function renderQ2(){
      const qs = await loadQuestions();
      const slice = qs.slice(10, 20);
      const mount = document.getElementById('q2List');
      mount.innerHTML = slice.map(q => renderQuestionHTML(q)).join('');

      // restore
      slice.forEach(q => {
        const v = sarState.answers[q.id];
        if(v){ const el = document.getElementById(`${q.id}_${v}`); if (el) el.checked = true; }
      });

      mount.onchange = onRatingChangedQ2;
      updateQ2Progress(slice);
      validateQ2Completed(slice);
    }

    function renderQuestionHTML(q){
      const name = `rate_${q.id}`;
      let radios = '';
      for(let v=1; v<=5; v++){
        const id = `${q.id}_${v}`;
        radios += `
          <input type="radio" name="${name}" id="${id}" value="${v}" />
          <label for="${id}" aria-label="${q.id} rate ${v}">${v}</label>
        `;
      }
      return `
        <div class="q-item" data-qid="${q.id}">
          <div class="q-title">${escapeHTML(q.statement)}</div>
          <div class="q-sub">${escapeHTML(q.subtext)}</div>
          <div class="q-scale">${radios}</div>
        </div>
      `;
    }

    // Handlers for Q1/Q2
    function onRatingChangedQ1(e){
      const input = e.target.closest('input[type="radio"]'); if(!input) return;
      const wrap = input.closest('.q-item'); const qid = wrap?.getAttribute('data-qid');
      const val = parseInt(input.value, 10);
      if(qid && val>=1 && val<=5){
        sarState.answers[qid] = val;
        const list = Array.from(document.querySelectorAll('#q1List .q-item'));
        updateQ1Progress(list);
        validateQ1Completed(list);
      }
    }
    function onRatingChangedQ2(e){
      const input = e.target.closest('input[type="radio"]'); if(!input) return;
      const wrap = input.closest('.q-item'); const qid = wrap?.getAttribute('data-qid');
      const val = parseInt(input.value, 10);
      if(qid && val>=1 && val<=5){
        sarState.answers[qid] = val;
        const list = Array.from(document.querySelectorAll('#q2List .q-item'));
        updateQ2Progress(list);
        validateQ2Completed(list);
      }
    }

    // Progress + validation
    function updateQ1Progress(list){
      const items = Array.from(list);
      const total = items.length;
      const answered = items.filter(el => sarState.answers[el.getAttribute('data-qid')]).length;
      const pct = total ? Math.round((answered/total)*100) : 0;
      const bar = document.getElementById('q1Prog'); if(bar) bar.style.width = pct + '%';
    }
    function updateQ2Progress(list){
      const items = Array.from(list);
      const total = items.length;
      const answered = items.filter(el => sarState.answers[el.getAttribute('data-qid')]).length;
      const pct = total ? Math.round((answered/total)*100) : 0;
      const bar = document.getElementById('q2Prog'); if(bar) bar.style.width = pct + '%';
    }
    function validateQ1Completed(list){
      const items = Array.from(list);
      const allAnswered = items.every(el => sarState.answers[el.getAttribute('data-qid')]);
      document.getElementById('q1Next').disabled = !allAnswered;
    }
    function validateQ2Completed(list){
      const items = Array.from(list);
      const allAnswered = items.every(el => sarState.answers[el.getAttribute('data-qid')]);
      document.getElementById('q2Next').disabled = !allAnswered;
    }

    // simple HTML escape
    function escapeHTML(s){
      return String(s).replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c]));
    }

    // Init
    goTo(sarState.step);
  </script>
</body>
</html>
