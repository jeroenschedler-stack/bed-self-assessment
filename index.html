<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>BED Hospitality — Self-Assessment (SAR)</title>
  <meta name="theme-color" content="#1E90FF" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
  <link rel="icon" href='data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64"><rect width="64" height="64" rx="12" fill="%231E90FF"/><text x="50%" y="56%" font-size="28" font-family="Arial,Helvetica,sans-serif" font-weight="700" text-anchor="middle" fill="white">BED</text></svg>'>

  <style>
    :root{
      --brand:#1E90FF;
      --border:#E5E7EB;
      --text:#111827;
      --sub:#374151;
      --active:#bf0101; /* new red for completed/current dots */
      --header-h:64px;
    }
    *{box-sizing:border-box}
    html,body{width:100%;height:auto;margin:0;padding:0}
    body{
      font-family:Inter,system-ui,-apple-system,Arial,sans-serif;
      background:#F9FAFB;color:var(--text);
      padding-top: var(--header-h);
    }

    /* Header */
    .sar-header{
      position:fixed; top:0; left:0; right:0; z-index:1000;
      height:var(--header-h);
      display:flex; align-items:center; justify-content:flex-start;
      padding:0 12px; background:#fff; border-bottom:1px solid var(--border);
      gap:12px;
    }
    @media (min-width:768px){ .sar-header{padding:0 16px} }

    .sar-logo-wrap{ display:flex; flex-direction:column; align-items:flex-start; gap:6px; }
    .sar-logo{ font-size:28px; font-weight:800; letter-spacing:.35px; color:var(--text); white-space:nowrap; }
    .sar-dotbar{ display:flex; gap:10px; align-items:center; justify-content:flex-start }
    /* Dots 20% smaller (16px -> ~13px), no borders, new red for done/current */
    .sar-dot{ width:13px; height:13px; border-radius:50%; background:#E5E7EB; box-shadow:none; border:none; }
    .sar-dot.done{ background:var(--active); }
    .sar-dot.current{ background:var(--active); } /* current is also red */

    /* Global progress bar placed INSIDE header, shown only on q1/q2 */
    .global-progress{ width:100%; height:6px; /* 50% thicker than 4px */ 
      background:#E5E7EB; border-radius:3px; overflow:hidden; display:none; }
    .global-progress.show{ display:block; }
    .global-progress > span{ display:block; height:100%; width:0; background:var(--brand); transition:width .25s ease; }

    /* Layout */
    .sar-wrap{max-width:100%;width:100%;margin:0;padding:8px 12px 24px}
    @media (min-width:768px){ .sar-wrap{max-width:560px;margin:16px auto;padding:0 16px 24px} }

    /* Card */
    .sar-card{ background:#fff;border:1px solid var(--border);border-radius:12px;
      padding:20px 16px;box-shadow:0 1px 2px rgba(0,0,0,.04);min-height:auto }
    @media (max-width:430px){
      .sar-wrap{padding:0}
      .sar-card{border:none;box-shadow:none;border-radius:0;padding:16px}
      body{padding-bottom:env(safe-area-inset-bottom,16px)}
    }

    /* Titles */
    .sar-title{font-size:18px;font-weight:600;margin:8px 0 12px}
    .sar-sub{color:var(--sub);margin-bottom:16px}

    /* Rows & buttons */
    .sar-row{display:flex;gap:8px;flex-wrap:wrap}
    .sar-actions{display:flex;gap:8px;margin-top:16px;justify-content:flex-end}
    .sar-btn{
      display:inline-flex;align-items:center;justify-content:center;
      min-height:44px;min-width:140px;
      padding:10px 18px;border-radius:8px;border:1px solid #D1D5DB;
      background:#fff;color:var(--text);cursor:pointer;text-decoration:none;user-select:none;
      font-size:16px;font-weight:600;
    }
    .sar-btn.primary{background:var(--brand);color:#fff;border-color:var(--brand)}
    .sar-btn:disabled{opacity:.6;cursor:not-allowed}

    /* Pages */
    .sar-page{display:none}
    .sar-page.active{display:block}

    /* Inputs */
    .sar-row-fields{gap:12px}
    .sar-field{flex:1;min-width:0;display:flex;flex-direction:column;gap:6px}
    .sar-label{font-size:12px;color:#6B7280}
    .sar-input{
      height:44px;padding:8px 10px;border:1px solid #D1D5DB;border-radius:8px;
      background:#fff;color:var(--text);outline:none;font-size:16px
    }
    .sar-input:focus{border-color:var(--brand);box-shadow:0 0 0 3px rgba(30,144,255,.15)}
    @media (max-width:420px){ .sar-row-fields{flex-direction:column} }

    /* Hotels one row */
    .sar-hotels{display:flex;gap:6px;flex-wrap:nowrap;justify-content:space-between}
    .sar-hotels .sar-hotel{flex:1 1 18%;min-width:0;text-transform:uppercase;font-weight:600;padding:10px 0;font-size:14px}
    .sar-hotel.selected{background:var(--brand);color:#fff;border-color:var(--brand)}

    /* Intro & scale (welcome) */
    .sar-intro p,.sar-scale{font-size:14px;line-height:1.45}
    @media (max-width:360px){ .sar-intro p,.sar-scale{font-size:13px} }
    .sar-scale-row{display:flex;align-items:center;gap:10px;margin:6px 0}
    .sar-badge{display:inline-flex;align-items:center;justify-content:center;width:24px;height:24px;border-radius:50%;background:var(--brand);color:#fff;font-size:13px;font-weight:600}

    /* Extra space above start */
    .sar-page[data-step="welcome"] .sar-scale{margin-bottom:56px}

    /* Questions */
    .q-list{display:flex;flex-direction:column;gap:14px}
    .q-item{padding:12px 0;border-top:1px solid var(--border)}
    .q-item:first-child{border-top:none}
    .q-title{font-size:15px;font-weight:600;line-height:1.35;margin-bottom:2px}
    .q-sub{font-size:15px;line-height:1.35;color:var(--sub);margin-bottom:8px}
    .q-scale{display:flex;gap:8px}
    .q-scale input[type="radio"]{position:absolute;opacity:0;pointer-events:none}
    .q-scale label{
      width:36px;height:36px;border-radius:50%;
      border:1px solid #D1D5DB;background:#fff;color:#111827;
      display:inline-flex;align-items:center;justify-content:center;
      font-size:14px;font-weight:600;cursor:pointer;user-select:none;
    }
    .q-scale input[type="radio"]:checked + label{
      background:var(--brand);border-color:var(--brand);color:#fff;
    }

    /* SCORE PAGE */
    .score-wrap{display:flex;flex-direction:column;gap:14px}
    .score-top{display:flex;align-items:baseline;gap:12px}
    .score-big{font-size:40px;font-weight:800;line-height:1}
    .score-band{font-size:16px;font-weight:700;color:#374151}
    .score-bar{position:relative;display:grid;grid-template-columns:repeat(5,1fr);gap:2px;height:14px;border-radius:7px;overflow:hidden;border:1px solid var(--border)}
    .score-seg{height:100%}
    .seg-1{background:#ef4444}
    .seg-2{background:#f59e0b}
    .seg-3{background:#eab308}
    .seg-4{background:#22c55e}
    .seg-5{background:#10b981}
    .score-marker{position:absolute;top:-6px;width:0;height:0;border-left:6px solid transparent;border-right:6px solid transparent;border-bottom:6px solid #6B7280;transform:translateX(-50%)} /* gray triangle */
    .score-text{font-size:14px;color:#374151}

  </style>
</head>
<body>

  <!-- Header -->
  <header class="sar-header">
    <div class="sar-logo-wrap">
      <div class="sar-logo">BED HOSPITALITY 2.0</div>
      <div class="sar-dotbar" id="dotbar" aria-label="Progress"></div>
      <!-- Global progress bar inside header -->
      <div class="global-progress" id="gprog" aria-hidden="true"><span id="gprogFill"></span></div>
    </div>
  </header>

  <main class="sar-wrap">
    <section class="sar-card">

      <!-- Welcome -->
      <div class="sar-page" data-step="welcome">
        <div style="max-width:75%">
          <div class="sar-title">SELF-ASSESSMENT (SAR)</div>
        </div>

        <div class="sar-row sar-row-fields" style="margin-bottom:12px">
          <label class="sar-field">
            <span class="sar-label">your nickname</span>
            <input id="sarNick" type="text" class="sar-input" inputmode="text" autocomplete="nickname" />
          </label>
          <label class="sar-field">
            <span class="sar-label">your email</span>
            <input id="sarEmail" type="email" class="sar-input" inputmode="email" autocomplete="email" />
          </label>
        </div>

        <div class="sar-row sar-hotels" role="group" aria-label="Choose your BED Hotel" style="margin-bottom:12px">
          <button class="sar-btn sar-hotel" data-hotel="BCK">BCK</button>
          <button class="sar-btn sar-hotel" data-hotel="BPS">BPS</button>
          <button class="sar-btn sar-hotel" data-hotel="BNM">BNM</button>
          <button class="sar-btn sar-hotel" data-hotel="BCG">BCG</button>
          <button class="sar-btn sar-hotel" data-hotel="BED">BED</button>
        </div>

        <div class="sar-intro" style="margin-bottom:8px">
          <p>Self-assessment helps your personal growth and development. Read each statement and think how you act in these situations. Then select the rating that best fits you. Be honest with yourself. The goal is to know your own strengths and opportunities.</p>
        </div>

        <div class="sar-scale" style="margin-bottom:8px">
          <div class="sar-scale-row"><span class="sar-badge">1</span><span>I'm not good at this</span></div>
          <div class="sar-scale-row"><span class="sar-badge">2</span><span>I can do better in this</span></div>
          <div class="sar-scale-row"><span class="sar-badge">3</span><span>I'm good at this</span></div>
          <div class="sar-scale-row"><span class="sar-badge">4</span><span>I'm great at this</span></div>
          <div class="sar-scale-row"><span class="sar-badge">5</span><span>I'm excellent at this</span></div>
        </div>

        <div class="sar-actions">
          <button id="sarStart" class="sar-btn primary" data-nav="goto" data-step="q1" disabled>start</button>
        </div>
      </div>

      <!-- Part 1 — Dynamic questions -->
      <div class="sar-page" data-step="q1">
        <div class="sar-title" style="margin-bottom:6px">STATEMENTS PART 1</div>
        <!-- removed page-level thin progress bar (now in header) -->
        <div id="q1List" class="q-list" aria-live="polite"></div>
        <div class="sar-actions">
          <button class="sar-btn" data-nav="back">Back</button>
          <button id="q1Next" class="sar-btn primary" data-nav="goto" data-step="q2" disabled>Next</button>
        </div>
      </div>

      <!-- Part 2 — Dynamic questions -->
      <div class="sar-page" data-step="q2">
        <div class="sar-title" style="margin-bottom:6px">STATEMENTS PART 2</div>
        <!-- removed page-level thin progress bar (now in header) -->
        <div id="q2List" class="q-list" aria-live="polite"></div>
        <div class="sar-actions">
          <button class="sar-btn" data-nav="back">Back</button>
          <button id="q2Next" class="sar-btn primary" data-nav="next" disabled>Next</button>
        </div>
      </div>

      <!-- Placeholders -->
      <div class="sar-page" data-step="score">
        <div class="sar-title">SELF-ASSESSMENT SCORE</div>
        <div id="scoreWrap" class="score-wrap">
          <div class="score-top">
            <div class="score-big" id="scoreValue">--</div>
            <div class="score-band" id="scoreBand">—</div>
          </div>
          <div class="score-bar" aria-label="Score scale 0 to 100">
            <div class="score-seg seg-1" data-min="0" data-max="20" title="0–20"></div>
            <div class="score-seg seg-2" data-min="21" data-max="40" title="21–40"></div>
            <div class="score-seg seg-3" data-min="41" data-max="60" title="41–60"></div>
            <div class="score-seg seg-4" data-min="61" data-max="80" title="61–80"></div>
            <div class="score-seg seg-5" data-min="81" data-max="100" title="81–100"></div>
            <div class="score-marker" id="scoreMarker" aria-hidden="true"></div>
          </div>
          <div class="score-text" id="scoreText"></div>
        </div>
        <div class="sar-actions">
          <button class="sar-btn" data-nav="back">Back</button>
          <button id="scoreNext" class="sar-btn primary" data-nav="goto" data-step="peer">Next</button>
        </div>
      </div>
      <div class="sar-page" data-step="peer"><div class="sar-title">Peer Review</div></div>
      <div class="sar-page" data-step="done"><div class="sar-title">Done</div></div>
      <div class="sar-page" data-step="finish"><div class="sar-title">Finish</div></div>

    </section>
  </main>

  <script>
    const SAR_STEPS = ["welcome","q1","q2","score","peer","done","finish"];

    const sarState = {
      step: "welcome",
      user: { nickname: "", email: "", hotel: "" },
      answers: {},
      questions: []
    };

    function goTo(step){
      if(!SAR_STEPS.includes(step)) return;
      sarState.step = step;
      document.querySelectorAll('.sar-page').forEach(p=>{
        p.classList.toggle('active', p.dataset.step === step);
      });
      renderDots();
      updateGlobalProgress();
      if(step === "welcome") ensureWelcomeBindings();
      if(step === "q1") renderQ1();
      if(step === "q2") renderQ2();
      if(step === "score") renderScore();
      window.scrollTo({ top: 0, behavior: 'instant' });
    }
    function next(){
      const i = SAR_STEPS.indexOf(sarState.step);
      if(i < SAR_STEPS.length - 1) goTo(SAR_STEPS[i+1]);
    }
    function back(){
      const i = SAR_STEPS.indexOf(sarState.step);
      if(i > 0) goTo(SAR_STEPS[i-1]);
    }
    document.body.addEventListener('click', (e)=>{
      const btn = e.target.closest('[data-nav]');
      if(!btn) return;
      const act = btn.getAttribute('data-nav');
      if(act==='next') next();
      else if(act==='back') back();
      else if(act==='goto'){ const step = btn.getAttribute('data-step'); if(step) goTo(step); }
    });

    function renderDots(){
      const bar = document.getElementById('dotbar');
      bar.innerHTML = '';
      const currentIndex = SAR_STEPS.indexOf(sarState.step);
      SAR_STEPS.forEach((step, idx)=>{
        const d = document.createElement('div');
        let cls = 'sar-dot';
        if(idx <= currentIndex){ cls += ' done'; }
        if(idx === currentIndex){ cls += ' current'; }
        d.className = cls;
        bar.appendChild(d);
      });
    }

    let welcomeBound = false;
    function ensureWelcomeBindings(){
      if(welcomeBound){ validateWelcome(); return; }
      welcomeBound = true;
      const card = document.querySelector('.sar-page[data-step="welcome"]');
      const nick = card.querySelector('#sarNick');
      const email = card.querySelector('#sarEmail');
      const startBtn = card.querySelector('#sarStart');

      card.addEventListener('click',(e)=>{
        const btn = e.target.closest('.sar-hotel');
        if(!btn) return;
        card.querySelectorAll('.sar-hotel').forEach(b=>b.classList.remove('selected'));
        btn.classList.add('selected');
        sarState.user.hotel = btn.getAttribute('data-hotel') || "";
        validateWelcome();
      });
      nick.addEventListener('input', ()=>{ sarState.user.nickname = nick.value.trim(); validateWelcome(); });
      email.addEventListener('input', ()=>{ sarState.user.email = email.value.trim(); validateWelcome(); });
      startBtn.addEventListener('click',(e)=>{ if(startBtn.disabled){ e.preventDefault(); e.stopPropagation(); } });
      validateWelcome();
    }
    function validateWelcome(){
      const card = document.querySelector('.sar-page[data-step="welcome"]');
      if(!card) return;
      const nick = card.querySelector('#sarNick');
      const email = card.querySelector('#sarEmail');
      const startBtn = card.querySelector('#sarStart');
      const hasNick = (nick.value || "").trim().length > 0;
      const hasEmail = /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test((email.value || "").trim());
      const hasHotel = !!sarState.user.hotel;
      startBtn.disabled = !(hasNick && hasEmail && hasHotel);
    }

    async function loadQuestions(){
      if (sarState.questions.length) return sarState.questions;
      const res = await fetch('./questions.json?v=1', {cache: 'no-store'});
      const data = await res.json();
      sarState.questions = Array.isArray(data) ? data : [];
      return sarState.questions;
    }

    async function renderQ1(){
      const qs = await loadQuestions();
      const slice = qs.slice(0, 10);
      const mount = document.getElementById('q1List');
      mount.innerHTML = slice.map(q => renderQuestionHTML(q)).join('');
      slice.forEach(q => {
        const v = sarState.answers[q.id];
        if(v){ const el = document.getElementById(`${q.id}_${v}`); if (el) el.checked = true; }
      });
      mount.onchange = onRatingChanged;
      updateGlobalProgress();
      validateQ1Completed(slice);
    }

    async function renderQ2(){
      const qs = await loadQuestions();
      const slice = qs.slice(10, 20);
      const mount = document.getElementById('q2List');
      mount.innerHTML = slice.map(q => renderQuestionHTML(q)).join('');
      slice.forEach(q => {
        const v = sarState.answers[q.id];
        if(v){ const el = document.getElementById(`${q.id}_${v}`); if (el) el.checked = true; }
      });
      mount.onchange = onRatingChanged;
      updateGlobalProgress();
      validateQ2Completed(slice);
    }

    function renderQuestionHTML(q){
      const name = `rate_${q.id}`;
      let radios = '';
      for(let v=1; v<=5; v++){
        const id = `${q.id}_${v}`;
        radios += `
          <input type="radio" name="${name}" id="${id}" value="${v}" />
          <label for="${id}" aria-label="${q.id} rate ${v}">${v}</label>
        `;
      }
      return `
        <div class="q-item" data-qid="${q.id}">
          <div class="q-title">${escapeHTML(q.statement)}</div>
          <div class="q-sub">${escapeHTML(q.subtext)}</div>
          <div class="q-scale">${radios}</div>
        </div>
      `;
    }

    // one handler for both pages
    function onRatingChanged(e){
      const input = e.target.closest('input[type="radio"]'); if(!input) return;
      const wrap = input.closest('.q-item'); const qid = wrap?.getAttribute('data-qid');
      const val = parseInt(input.value, 10);
      if(qid && val>=1 && val<=5){
        sarState.answers[qid] = val;
        updateGlobalProgress();
        if(sarState.step === 'q1'){
          const list = Array.from(document.querySelectorAll('#q1List .q-item'));
          validateQ1Completed(list);
        } else if(sarState.step === 'q2'){
          const list = Array.from(document.querySelectorAll('#q2List .q-item'));
          validateQ2Completed(list);
        }
      }
    }

    function validateQ1Completed(list){
      const items = Array.from(list);
      const allAnswered = items.every(el => sarState.answers[el.getAttribute('data-qid')]);
      document.getElementById('q1Next').disabled = !allAnswered;
    }
    function validateQ2Completed(list){
      const items = Array.from(list);
      const allAnswered = items.every(el => sarState.answers[el.getAttribute('data-qid')]);
      document.getElementById('q2Next').disabled = !allAnswered;
    }

    // Global progress across all 20 questions; visible only on q1/q2
    function updateGlobalProgress(){
      const bar = document.getElementById('gprog');
      const fill = document.getElementById('gprogFill');
      const show = (sarState.step === 'q1' || sarState.step === 'q2');
      bar.classList.toggle('show', show);
      if(!show) return;
      const total = (sarState.questions && sarState.questions.length) ? sarState.questions.length : 20;
      const answered = Object.keys(sarState.answers).length;
      const pct = total ? Math.round((answered/total)*100) : 0;
      fill.style.width = pct + '%';
    }

    // Correct escapeHTML
    function escapeHTML(s){
      return String(s).replace(/[&<>\"']/g, function(c){
        return ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c]);
      });
    }


    // Bands for score interpretation
    const SCORE_BANDS = [
      {min:0,  max:20,  label:"BEGINNER",  text:"You’re starting your Journey. Focus on basics and consistent routine."},
      {min:21, max:40,  label:"EMERGING",  text:"You show potential. Practice the standards more consistently in daily work."},
      {min:41, max:60,  label:"COMPETENT", text:"Solid base. Keep refining and start helping others with best practices."},
      {min:61, max:80,  label:"ADVANCED",  text:"Strong performer. Lead small improvements and mentor peers."},
      {min:81, max:100, label:"EXCELLENT", text:"Role model. Share methods and help define new standards."}
    ];

    function calcTotalScore(){
      // Sum of all answered ratings (20–100). If unanswered, treat as 0.
      let total = 0;
      const qs = sarState.questions.length ? sarState.questions : [];
      const ids = qs.length ? qs.map(q=>q.id) : Object.keys(sarState.answers);
      ids.forEach(id => { total += (sarState.answers[id] || 0); });
      return total;
    }

    function findBand(score){
      return SCORE_BANDS.find(b => score >= b.min && score <= b.max) || SCORE_BANDS[0];
    }

    function renderScore(){
      const total = calcTotalScore();
      const band = findBand(total);
      // numbers
      const elVal = document.getElementById('scoreValue');
      const elBand = document.getElementById('scoreBand');
      const elText = document.getElementById('scoreText');
      if(elVal) elVal.textContent = String(total);
      if(elBand) elBand.textContent = band.label;
      if(elText) elText.textContent = band.text;

      // marker position along 0..100 bar
      const bar = document.querySelector('.score-bar');
      const marker = document.getElementById('scoreMarker');
      if(bar && marker){
        const pct = Math.max(0, Math.min(100, total)); // clamp
        marker.style.left = pct + '%';
      }
    }

    goTo(sarState.step);
  </script>
</body>
</html>
